---
title: "tp1_temporal_series"
author: "vkerros"
date: '2022-04-22'
output: html_document
---

## Q1 : importation des données et des packages

```{r data}
datafile <- "Donnees1.csv"
data <- read.csv(datafile,sep=";")
```

```{r packages}
require(zoo)
require(tseries)
```

```{r formalisation}
xm.source <- zoo(data[[1]]) # convertit le 1er élément de data en "zoo"
T <- length(xm.source)
xm <- xm.source[1:(T-4)] # supprime les 4 dernières valeurs
```

## Q2 : représentation graphique et désaisonnalisation

```{r plot}
plot(xm, xaxt="n") # représente xm sans l’axe des abcisses
axis(side=1,at=seq(0,196,12)) # affiche l’axe des abcisses par 12 de 0 à 196
```

On suspecte une saisonnalité de périodicité 12, ce que l’on peut confirmer en représentant les fonctions d’autocorrélation totale de la série.

```{r acf}
acf(xm) # trace l’autocorrélogramme total
```

On peut tenter de supprimer cette saisonnalité en corrigeant la série par son 12ème retard.

```{r desaison}
desaison <- xm - lag(xm, -12) # retire le 12ème retard
par(mfrow = c(1,2)) # dispose les graphiques en 1 colonne et 2 lignes
plot(desaison)
acf(desaison)
```

## Q3 : étude des auto-corrélogrammes de la série desaison

```{r (p)acf desaison}
acf(desaison) # trace les fonctions d’autocorrélation totale
pacf(desaison) # trace les fonctions d’autocorrélation partielle
```

L’autocorrélation d’ordre 1 (totale ou partielle, c’est la même chose) est d’environ -0.3, soit petite et loin d’être égale à 1. La série semble donc stationnaire.

## Q4 : test racine unitaire

La représentation de desaison à la question 2 semble nous indiquer que la série ne présente pas de tendance.
Nous pouvons donc effectuer par exemple comme test de racine unitaire :
- un test de Dickey-Fuller augmenté (ADF) dans le cas avec constante non nulle et sans tendance ;
- un test de Phillips-Perron intégrant une constante dans l’équation de régression.


```{r pp test}
pp.test(desaison) # pp test sur la série (cas général : avec constante et tendance)
```
L’hypothèse nulle de racine unitaire est rejetée à un seuil de 95% (p-value = 0.01 < 0.05), on dira que la série est stationnaire.

## Q5 :  ARIMA -> ordres maximums p∗, d∗, q∗ vraisemblables pour la série desaison

Soit y la série centrée. On regarde ensuite les autocorrélogrammes total et partiel de y, jusqu’à un horizon raisonnable (deux périodicités = 24).

```{r (p)acf y}
y <- desaison - mean(desaison) # centre la série
acf(y,24); pacf(y, 24) # le point virgule valide la commande comme un saut de ligne
```

Comme la série est stationnaire, elle est intégrée d’ordre d = 0.
Les fonctions d’autocorr´elation totales sont significatives (i.e. plus grandes que les bornes ±1, 96/ √n de l’intervalle de confiance d’un test de nullité de l’autocorrélation à un seuil de 95%) jusqu’à q∗ = 2 et les autocorrélations partielles jusqu’à p∗ = 3. Si y suit un ARIMA(p,d,q), elle suit donc au plus un ARIMA(p∗ = 3, d∗ = 0, q∗ = 2), que l’on peut estimer.

```{r arima}
arima(y, c(3,0,2)) # régresse l’ARIMA(3,0,2) pour la série y
```

```{r test LB}
arima302 <- arima(y,c(3,0,2)) # enregistre les résultats de l’estimation
Box.test(arima302$residuals, lag=6, type="Ljung-Box", fitdf=5) # test de Ljung-Box

```